## 你有几种方式创建对象？

- new
  - 最常见的方式
  - 变形1：Xxx的静态方法
  - 变形2：XxxBuilder/XxxFactory的静态方法

- Class的newInstance()：反射的方式，只能调用空参的构造器，权限必须是public
- Constructor的newInstance(Xxx)：反射的方式，可以调用空参、带参的构造器，权限没有要求，实用性更广
- 使用clone()：不调用任何构造器，当前类需要实现Cloneable接口，实现clone()，默认浅拷贝
- 使用反序列化：从文件中、数据库中、网络中获取一个对象的二进制流，反序列化为内存中的对象
- 第三方库Objenesis，利用了asm字节码技术，动态生成Constructor对象

## 创建对象的步骤

### 从字节码角度看待对象创建过程

<font color = 'blue'>(1)下面从最简单的Object ref = new Object()； 代码进行分析，利用javap -verbose -p 命令查看对象创建的字节码如下：</font>

![](images/1.字节码创建对象过程.jpeg)

- NEW ：如果找不到Class对象，则进行类加载。加载成功后，则在堆中分配内存，从Object 开始到本类路径上的所有属性值都要分配内存。分配完毕之后，进行零值初始化。在分配过程中，注意引用是占据存储空间的，它是一个变量，占用4个字节。这个指令完毕后，将指向实例对象的引用变量压入虚拟机栈顶。
- DUP ：在栈顶复制该引用变量，这时的栈顶有两个指向堆内实例对象的引用变量。如果<init> 方法有参数，还需要把参数压人操作栈中。两个引用变量的目的不同，其中压至底下的引用用于赋值，或者保存到局部变量表，另一个栈顶的引用变量作为句柄调用相关方法。
- INVOKESPECIAL ：调用对象实例方法，通过栈顶的引用变量调用＜init> 方法。

补充：
<clinit> 是类初始化时执行的方法， 而<init> 是对象初始化时执行的方法。

### 从执行步骤角度分析





