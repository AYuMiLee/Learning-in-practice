## 合理配置堆内存

### 推荐配置

在案例1中我们讲到了增加内存可以提高系统的性能而且效果显著，那么随之带来的一个问题就是，我们增加多少内存比较合适？如果内存过大，那么如果产生FullGC的时候，GC时间会相对比较长，如果内存较小，那么就会频繁的触发GC，在这种情况下，我们该如何合理的适配堆内存大小呢？

分析：
依据的原则是根据Java Performance里面的推荐公式来进行设置。

![](images/1.JVM内存配置.jpeg)

<font color = 'red'>Java整个堆大小设置，Xmx 和 Xms设置为老年代存活对象的3-4倍，即FullGC之后的老年代内存占用的3-4倍。</font>

方法区（永久代 PermSize和MaxPermSize 或 元空间 MetaspaceSize 和MaxMetaspaceSize）设置为老年代存活对象的1.2-1.5倍。

年轻代Xmn的设置为老年代存活对象的**1-1.5倍**。

老年代的内存大小设置为老年代存活对象的**2-3倍**。

但是，上面的说法也不是绝对的，也就是说这给的是一个参考值，根据多种调优之后得出的一个结论，大家可以根据这个值来设置一下我们的初始化内存，在保证程序正常运行的情况下，我们还要去查看GC的回收率，GC停顿耗时，内存里的实际数据来判断，Full GC是基本上不能有的，如果有就要做内存Dump分析，然后再去做一个合理的内存分配。

<font color = 'red'>我们还要注意到一点就是，上面说的老年代存活对象怎么去判定。</font>



 
